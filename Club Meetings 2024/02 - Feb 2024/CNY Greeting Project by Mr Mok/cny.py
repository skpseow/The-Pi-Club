from machine import Pin, PWM, I2C
from utime import sleep
from ssd1306 import SSD1306_I2C
import framebuf
buzzer = PWM(Pin(16))

tones = {
    "B0": 31,
    "C1": 33,
    "CS1": 35,
    "D1": 37,
    "DS1": 39,
    "E1": 41,
    "F1": 44,
    "FS1": 46,
    "G1": 49,
    "GS1": 52,
    "A1": 55,
    "AS1": 58,
    "B1": 62,
    "C2": 65,
    "CS2": 69,
    "D2": 73,
    "DS2": 78,
    "E2": 82,
    "F2": 87,
    "FS2": 93,
    "G2": 98,
    "GS2": 104,
    "A2": 110,
    "AS2": 117,
    "B2": 123,
    "C3": 131,
    "CS3": 139,
    "D3": 147,
    "DS3": 156,
    "E3": 165,
    "F3": 175,
    "FS3": 185,
    "G3": 196,
    "GS3": 208,
    "A3": 220, #"A3": 220
    "AS3": 233,
    "B3": 247, #"B3": 247
    "C4": 261, #"C4": 262,
    "CS4": 277,
    "D4": 294, #"D4": 294
    "DS4": 311,
    "E4": 329, #"E4": 330,
    "F4": 349,
    "FS4": 370,
    "G4": 391, #"G4": 392,
    "GS4": 415,
    "A4": 440,
    "AS4": 466,
    "B4": 493, #"B4": 494,
    "C5": 523,
    "CS5": 554,
    "D5": 587, #"D5":587
    "DS5": 622,
    "E5": 659, #"E5": 659
    "F5": 698,
    "FS5": 740,
    "G5": 783, #"G5": 784,
    "GS5": 831,
    "A5": 880,
    "AS5": 932,
    "B5": 987, #"B5": 988,
    "C6": 1047,
    "CS6": 1109,
    "D6": 1175,
    "DS6": 1245,
    "E6": 1319,
    "F6": 1397,
    "FS6": 1480,
    "G6": 1568,
    "GS6": 1661,
    "A6": 1760,
    "AS6": 1865,
    "B6": 1976,
    "C7": 2093,
    "CS7": 2217,
    "D7": 2349,
    "DS7": 2489,
    "E7": 2637,
    "F7": 2794,
    "FS7": 2960,
    "G7": 3136,
    "GS7": 3322,
    "A7": 3520,
    "AS7": 3729,
    "B7": 3951,
    "C8": 4186,
    "CS8": 4435,
    "D8": 4699,
    "DS8": 4978
    }

song1 = ["A4","B4","C5","D5","F5","E5","E5","P","E5","A5","A5","E5","E5","D5","D5","P","E5","F5","E5","D5","P","D5","C5","C5","P","C5","B5","A5","G5","P","A3","A3","P"]
song2 = ["D5","E5","C5","E5","P","B4","E5","A4","E5","P","D5","E5","C5","E5","P","B4","E5","A4","A4"]

def playtone(frequency):
    buzzer.duty_u16(1000)
    buzzer.freq(frequency)

def bequiet():
    buzzer.duty_u16(0)

def playsong(mysong):
    for i in range(len(mysong)):
        if (mysong[i] == "P"):
            bequiet()
        else:
            playtone(tones[mysong[i]])
            sleep(0.5)
    bequiet()

WIDTH =128 
HEIGHT= 64

i2c = I2C(1, sda=Pin(14), scl=Pin(15), freq=400000)
oled = SSD1306_I2C(WIDTH,HEIGHT,i2c)

oled.fill(0)
oled.text("Happy Chinese ", 0, 8)
oled.text("New Year", 0, 23)
oled.text("Year of Dragon", 0, 38)
oled.text("10 Feb, 2024", 0, 53)
oled.show()

sleep(5)

img = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00\x03\x8e\x00\x00?\x80\x00\x00\x03\x06\x00\x01\x81\x80\x00\x00\x03\x00\x00\x00\x01\x00\x00\x00\x02\x08\x00\x01\x81\x00\x00\x00\x03\xfc\x00\x01\x83\x00\x00\x00\x7f\x80\x00\x01\x83\x00\x00\x00\x06\xc4\x00\x01\x02\x00\x00\x00\x04\xc7\x00\x01\x028\x00\x00\x0c\x86\x00\x03~\x1c\x00\x00\x0c\x8c\x00\x01\x00\x0c\x00\x00\x18\x98\x00\x00\x00\x0c\x00\x00\x10\xb0\x00\x00\x07\x0c\x00\x000\xe0\x00\x03\xff\x88\x00\x00`\x80\x10\x1c\x00\x08\x00\x00\xc3\x80\x18\x00\x00\x18\x00\x01\x84@x\x00\x00\x18\x00\x02\x00\x7f\xf0\x00\x00\xf0\x00\x00\x00\x08\x00\x00\x00p\x00\x00\x00\x00\x00\x00\x00`\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x00\x00\x00\x00\x00\x10\x0c\x00\x00\x00\xc0\x00\x00\x18\x04\x00\x03\x80\xc0\x00\x00\x18\x05\xc0\x01\xc0\xc0\x00\x00\x19>\x00\x00\x00\xc0\x00\x00\t\x84\x00\x00\x00\xc0\x00\x01\x8b\x0f\x80\x00\x80\xdf\x00\x00\xc8\x04\x00\x03\xd7\xc7\x00\x00\x08\x05\xf8}\x88\xc7\x00\x00\x1c\xfc\x00\x03\x08\xf6\x00\x07\xd8\x01\x80\x03\x8b\xc6\x00\x008=\xc0\x07l\xc4\x00\x00, \x80\r$\xfc\x00\x00^.\x80\x19\x07\xc0\x00\x00\x98 \xc0\x11\x00\xc0\x00\x01\x18&\xc0!\x00\xc0\x00\x02\x18 \xc0\x03\x00\xc0\x00\x00\x18`\xc0\x03\x00\xc0\x00\x00\x10`\xc0\x03\x00\xc0\x00\x00\x10C\xc0\x00\x00\xc0\x00\x00\x10A\x80\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')

img2 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\x80\x00\x00\x0c\x00\x00\x00\x03\x00\x00\x06\x0c\x00\x00\x00\x048\x00\x06\x0c\x00\x00\x00\x13\x9c\x00\x0c\x04\x00\x00\x00\x08\x18\x00\x0c\x04\x00\x00\x00\x08\x98\x00\x18\x07\xf0\x00\x00\x0f\x19\x80\x11\xfc\x00\x00\x00\x08\x1b\x808\x1e\x00\x00\x00\x0f\x96\x00h\x15\x00\x00\x00\x08\x1c\x00\xc85\x00\x00\x00\x08x\x01\x88$\x80\x00\x00?0\x02\x08D`\x00\x03\xe0P\x00\x08\x84p\x00\x00\x01\x90\x00\t\x07\xb8\x00\x00\x03\x10\x00\n~\x1f\x00\x00\x06\x18\x00\x18\x04\x00\x00\x00\x18\x18\x00\x18\x0c\x00\x00\x00`\x18\x00\x18\x0c\x00\x00\x01\x80\x18\x00\x00\x0c\x00\x00\x00\x00p\x00\x00\x0c\x00\x00\x00\x000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00`\x00\x00\x00@0\x00\x000\x00\x00\x00`0\x00\x00\x01\x80\x00\x00`\x10\x00\x08?\x80\x00\x00\xc0\x17\x00\x0f\x00\x00\x00\x00\xc0\xf3\x00\x040\x00\x00\x01\x8e\x12\xc0\x0c\x13\x80\x00\x014\x1f\x00\r\xf1\x80\x00\x03\x8d\xd2\x00\x08\x11\xf8\x00\x06\x88\x1e\x00\x08?\x00\x00\x0c\x88\xd0\x00\x0b\xd3\x00\x00\x10\x98\x1e\x00\x18\x13\x00\x00\x00\x86\xf0\x00\x10>\x00\x00\x00\x84\x17\x00\x10\x10@\x00\x00\x85\xf8\x00&\x18\xc0\x00\x00\x8c\x10\x00#\x15\x00\x00\x00\x9c\x10\x00@\x93\x00\x00\x01\x9b\x90\x00C\x11\x80\x00\x01\x90\xf0\x00\x9e\x10\xf0\x00\x01\xa0\x1f\xf1\x08\xb0\x7f\x00\x00\x00\x03\x80\x00p\x00\x00\x00\x00\x00\x00\x000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')


fb = framebuf.FrameBuffer(img,64,64, framebuf.MONO_HLSB)
fb2 = framebuf.FrameBuffer(img2,64,64, framebuf.MONO_HLSB)
oled.fill(0) 
oled.blit(fb, 0, 0)
oled.show() 

start_x = 60 
start_y = 5 
lineskip = 15 
txt_array = ['Be','Active','and','Dynamic'] 
for iter_ii,txt in enumerate(txt_array):
    sleep(1)
    oled.text(txt,start_x,start_y+(iter_ii*lineskip)) 
    oled.show()
    
playsong(song1)
sleep(2)
oled.fill(0)
oled.blit(fb2, 0, 0) 
oled.show() 

start_x = 60 
start_y = 5 
lineskip = 15 
txt_array = ['Be','Happy','and','Healthy'] 
for iter_ii,txt in enumerate(txt_array):
    sleep(1)
    oled.text(txt,start_x,start_y+(iter_ii*lineskip)) 
    oled.show()
    
playsong(song2)
sleep(2)
oled.fill(0)
oled.show()
